{% extends 'base.html.twig' %}

{% block title %}Détails de la Classe - CampusFlow{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
    @keyframes fadeUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-up {
        animation: fadeUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
    .custom-scroll::-webkit-scrollbar-track { background: transparent; }
    .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
</style>
{% endblock %}

{% block body %}
<div class="min-h-[calc(100vh-5rem)] bg-slate-50 text-[#0F172A] relative font-sans flex flex-col p-4 md:p-8 overflow-y-auto">
    
    <!-- Background Decor -->
    <div class="absolute -top-[10%] -left-[10%] w-[60%] h-[60%] bg-[#0F172A]/5 rounded-full blur-[120px] pointer-events-none animate-pulse"></div>
    <div class="absolute bottom-0 right-0 w-[40%] h-[40%] bg-[#D97706]/5 rounded-full blur-[120px] pointer-events-none"></div>

    <div class="max-w-7xl mx-auto w-full z-10">
        
        <!-- Header Section -->
        <div class="mb-8 animate-fade-up">
            <a href="{{ path('admin_classe_index') }}" class="inline-flex items-center gap-2 text-slate-400 hover:text-[#D97706] transition-colors mb-4 text-xs font-bold uppercase tracking-wide group">
                <i class="fas fa-arrow-left group-hover:-translate-x-1 transition-transform"></i> Retour à la liste
            </a>

            <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6">
                <div class="flex items-center gap-6">
                    <div class="w-20 h-20 rounded-[1.5rem] bg-[#0F172A] text-white flex items-center justify-center shadow-xl border-4 border-white overflow-hidden relative group">
                        <i class="fa-solid fa-school text-3xl font-black text-[#D97706]/30 group-hover:scale-110 transition-transform duration-500"></i>
                        <span class="absolute inset-0 flex items-center justify-center font-black text-2xl">{{ classe.name|slice(0, 2)|upper }}</span>
                    </div>
                    
                    <div>
                        <h1 class="text-4xl md:text-5xl font-heading font-black text-[#0F172A] tracking-tight leading-none mb-1">
                            {{ classe.name }}
                        </h1>
                        <p class="text-sm font-bold text-slate-400 uppercase tracking-widest">{{ classe.academicYear }}</p>
                    </div>
                </div>

                <div class="flex gap-4">
                    <a href="{{ path('admin_classe_edit', {id: classe.id}) }}" class="group bg-white border border-slate-200 hover:border-[#D97706] hover:text-[#D97706] text-[#0F172A] px-6 py-3 rounded-2xl font-bold shadow-sm transition-all flex items-center gap-2 text-sm">
                        <i class="fa-solid fa-pen-nib"></i>
                        <span>Modifier</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            
            <!-- Side Info: Class Details -->
            <div class="lg:col-span-1 space-y-6">
                <div class="bg-white rounded-[2rem] shadow-sm border border-slate-100 p-6 animate-fade-up" style="animation-delay: 100ms;">
                    <h3 class="text-[10px] font-black text-[#D97706] uppercase tracking-[0.2em] mb-6 flex items-center gap-3">
                        Détails Académiques
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="group">
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wide block mb-1">Filière</span>
                            <p class="text-sm font-bold text-[#0F172A]">{{ classe.field }}</p>
                        </div>
                        <div class="group">
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wide block mb-1">Niveau</span>
                            <span class="inline-flex items-center px-2 py-1 rounded bg-slate-50 text-[#0F172A] text-[10px] font-black border border-slate-100">
                                {{ classe.level }}
                            </span>
                        </div>
                        <div class="group">
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wide block mb-1">Responsable</span>
                            {% if classe.supervisor %}
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 rounded bg-[#D97706]/10 text-[#D97706] flex items-center justify-center font-bold text-[8px]">
                                        {{ classe.supervisor.firstName|first }}{{ classe.supervisor.lastName|first }}
                                    </div>
                                    <span class="text-xs font-bold text-[#0F172A]">{{ classe.supervisor.fullName }}</span>
                                </div>
                            {% else %}
                                <span class="text-xs font-medium text-slate-400 italic">Non assigné</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Filling Card -->
                <div class="bg-[#0F172A] rounded-[2rem] shadow-xl p-6 text-white relative overflow-hidden animate-fade-up" style="animation-delay: 150ms;">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-[#D97706]/10 rounded-full -mr-16 -mt-16 blur-3xl"></div>
                    <h3 class="text-[10px] font-black text-[#D97706] uppercase tracking-[0.2em] mb-4 relative z-10">Remplissage</h3>
                    
                    <div class="relative z-10 flex items-end gap-3 mb-4">
                        <span class="text-4xl font-black">{{ classe.studentCount }}</span>
                        <span class="text-slate-400 font-bold mb-1">/ {{ classe.maxCapacity }}</span>
                    </div>

                    {% set percentage = (classe.studentCount / classe.maxCapacity * 100)|round %}
                    <div class="w-full h-2 bg-white/5 rounded-full overflow-hidden border border-white/10 relative z-10">
                        <div class="h-full bg-gradient-to-r from-[#D97706] to-amber-400 transition-all duration-1000" style="width: {{ percentage }}%"></div>
                    </div>
                    <p class="text-[10px] font-bold text-slate-400 mt-2 uppercase tracking-widest">{{ percentage }}% du quota atteint</p>
                </div>
            </div>

            <!-- Main Info: Students List -->
            <div class="lg:col-span-3 space-y-6">
                <div class="bg-white rounded-[2.5rem] shadow-[0_20px_60px_-15px_rgba(15,23,42,0.1)] border border-slate-100 overflow-hidden animate-fade-up" style="animation-delay: 200ms;">
                    <div class="px-8 py-6 border-b border-slate-50 flex justify-between items-center">
                        <h3 class="text-lg font-black text-[#0F172A]">Étudiants de la classe</h3>
                        <span class="text-[10px] font-black text-[#D97706] bg-[#D97706]/10 px-3 py-1 rounded-full uppercase tracking-widest">
                            {{ classe.students|length }} élèves
                        </span>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-slate-50/50">
                                    <th class="py-4 px-8 text-[10px] font-black text-slate-400 uppercase tracking-widest">Étudiant</th>
                                    <th class="py-4 px-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">CNE</th>
                                    <th class="py-4 px-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Email</th>
                                    <th class="py-4 px-8 text-[10px] font-black text-slate-400 uppercase tracking-widest text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-50">
                                {% for student in classe.students %}
                                <tr class="group hover:bg-slate-50/50 transition-colors">
                                    <td class="py-4 px-8">
                                        <div class="flex items-center gap-3">
                                            <div class="w-8 h-8 rounded-lg bg-[#0F172A]/5 text-[#0F172A] flex items-center justify-center font-bold text-[10px] group-hover:bg-[#0F172A] group-hover:text-white transition-all">
                                                {{ student.firstName|first }}{{ student.lastName|first }}
                                            </div>
                                            <span class="text-sm font-bold text-[#0F172A]">{{ student.fullName }}</span>
                                        </div>
                                    </td>
                                    <td class="py-4 px-6">
                                        <span class="text-xs font-mono font-bold text-slate-500 bg-slate-100 px-2 py-0.5 rounded">{{ student.cne }}</span>
                                    </td>
                                    <td class="py-4 px-6">
                                        <span class="text-xs font-medium text-slate-400">{{ student.user.email }}</span>
                                    </td>
                                    <td class="py-4 px-8 text-right">
                                        <a href="{{ path('admin_student_show', {id: student.id}) }}" class="text-[#D97706] hover:text-amber-600 font-black text-[10px] uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all">
                                            Profil <i class="fa-solid fa-arrow-right ml-1"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="4" class="py-12 text-center">
                                        <div class="flex flex-col items-center opacity-40">
                                            <i class="fa-solid fa-user-group text-3xl mb-2"></i>
                                            <p class="text-xs font-bold uppercase tracking-widest">Aucun étudiant inscrit</p>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}


