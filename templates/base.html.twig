<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}
        CampusFlow
      {% endblock %}
    </title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>üéì</text></svg>" />

    {% block stylesheets %}
      <!-- Google Fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com" />
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@500;600;700;800&display=swap" rel="stylesheet" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

      <!-- Tailwind Config MUST be before the CDN script -->
      <script>
        tailwind.config = {
          theme: {
            extend: {
              fontFamily: {
                sans: ['Inter', 'sans-serif'],
                heading: ['Poppins', 'sans-serif']
              },
              colors: {
                campus: {
                  bg: '#F7F5F2',
                  dark: '#264653',
                  teal: '#3A86FF',
                  sky: '#88C9E8',
                  peach: '#F4C095'
                }
              },
              animation: {
                'fade-in-up': 'fadeInUp 0.5s ease-out forwards'
              },
              keyframes: {
                fadeInUp: {
                  '0%': { opacity: '0', transform: 'translateY(10px)' },
                  '100%': { opacity: '1', transform: 'translateY(0)' }
                }
              }
            }
          }
        }
      </script>
      <script src="https://cdn.tailwindcss.com/3.4.1"></script>

      <style>
        /* Fallback and Robust Styles */
        .font-sans {
          font-family: 'Inter', sans-serif !important;
        }
        .font-heading {
          font-family: 'Poppins', sans-serif !important;
        }
        
        /* Explicit Theme Classes (Bypassing Tailwind JIT for critical elements) */
        .bg-campus-gradient {
          background: linear-gradient(135deg, #264653 0%, #3a86ff 100%) !important;
          background-size: 200% 200% !important;
        }
        
        /* New Palette Utility Classes */
        .text-campus-accent {
          color: #f4c095 !important;
        } /* Peach */
        .text-campus-primary {
          color: #3a86ff !important;
        } /* Blue (was Teal) */
        .bg-campus-primary {
          background-color: #3a86ff !important;
        }
        .text-campus-dark {
          color: #264653 !important;
        } /* Charcoal */
        .bg-campus-bg {
          background-color: #f7f5f2 !important;
        } /* Off-White */
        
        .bg-campus-blue {
          background-color: #264653 !important;
        } /* Fallback mapping */
        .text-campus-blue {
          color: #264653 !important;
        } /* Fallback mapping */
        
        /* Global Animation Utilities */
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .animate-fade-in-up {
          animation: fadeInUp 0.5s ease-out forwards;
        }
      </style>
    {% endblock %}

    {% block javascripts %}
      {% block importmap %}
        {{ importmap('app') }}
      {% endblock %}

      <script>
        document.addEventListener('turbo:visit', () => {
          // Clear pageInit to prevent stale execution
          window.pageInit = null
        })
        
        document.addEventListener('turbo:load', () => {
          if (typeof window.pageInit === 'function') {
            window.pageInit()
          }
        })
      </script>
    {% endblock %}
  </head>

  <body>
    {% if app.user %}
      <nav class="sticky top-0 z-50 w-full bg-[#0F172A]/90 backdrop-blur-xl border-b border-white/5 shadow-2xl transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between h-20">
            <!-- Left Side: Brand & Links -->
            <div class="flex items-center gap-10">
              <!-- Logo -->
              <a href="{% if 'ROLE_ADMIN' in app.user.roles %}
                  {{ path('admin_dashboard') }}
                {% elseif 'ROLE_TEACHER' in app.user.roles %}
                  {{ path('teacher_dashboard') }}
                {% else %}
                  {{ path('student_dashboard') }}
                {% endif %}"
                class="group flex items-center gap-3">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#D97706] to-[#92400E] flex items-center justify-center text-white shadow-xl shadow-amber-900/40 border border-white/10 group-hover:scale-110 transition-transform duration-500">
                  <span class="text-2xl">üèõÔ∏è</span>
                </div>
                <span class="font-heading font-black text-2xl tracking-tighter text-white group-hover:text-[#D97706] transition-colors">Campus<span class="text-[#D97706]">Flow</span></span>
              </a>

              <!-- Desktop Nav Links -->
              <div class="hidden md:flex items-center space-x-1">
                {% if 'ROLE_ADMIN' in app.user.roles %}
                  <a href="{{ path('admin_student_index') }}" class="px-4 py-2.5 rounded-xl text-sm font-bold text-slate-300 transition-all duration-200 hover:bg-white/5 hover:text-[#D97706] hover:shadow-lg hover:-translate-y-0.5 flex items-center gap-2 group">
                    <i class="fas fa-user-graduate text-xs opacity-50 group-hover:opacity-100 group-hover:text-[#D97706]"></i>
                    √âtudiants
                  </a>
                  <a href="{{ path('admin_teacher_index') }}" class="px-4 py-2.5 rounded-xl text-sm font-bold text-slate-300 transition-all duration-200 hover:bg-white/5 hover:text-[#D97706] hover:shadow-lg hover:-translate-y-0.5 flex items-center gap-2 group">
                    <i class="fas fa-chalkboard-teacher text-xs opacity-50 group-hover:opacity-100 group-hover:text-[#D97706]"></i>
                    Enseignants
                  </a>
                  <a href="{{ path('admin_classe_index') }}" class="px-4 py-2.5 rounded-xl text-sm font-bold text-slate-300 transition-all duration-200 hover:bg-white/5 hover:text-[#D97706] hover:shadow-lg hover:-translate-y-0.5 flex items-center gap-2 group">
                    <i class="fas fa-users text-xs opacity-50 group-hover:opacity-100 group-hover:text-[#D97706]"></i>
                    Classes
                  </a>
                  <a href="{{ path('admin_schedule_index') }}" class="px-4 py-2.5 rounded-xl text-sm font-bold text-slate-300 transition-all duration-200 hover:bg-white/5 hover:text-[#D97706] hover:shadow-lg hover:-translate-y-0.5 flex items-center gap-2 group">
                    <i class="fas fa-calendar-alt text-xs opacity-50 group-hover:opacity-100 group-hover:text-[#D97706]"></i>
                    Planning
                  </a>
                {% elseif 'ROLE_TEACHER' in app.user.roles %}
                  <a href="{{ path('teacher_dashboard') }}" class="px-4 py-2.5 rounded-xl text-sm font-bold text-slate-300 transition-all duration-200 hover:bg-white/5 hover:text-[#D97706] hover:shadow-lg hover:-translate-y-0.5 flex items-center gap-2 group">
                    <i class="fas fa-th-large text-xs opacity-50 group-hover:opacity-100 group-hover:text-[#D97706]"></i>
                    Dashboard
                  </a>
                  <a href="{{ path('teacher_grades_students') }}" class="px-4 py-2.5 rounded-xl text-sm font-bold text-slate-300 transition-all duration-200 hover:bg-white/5 hover:text-[#D97706] hover:shadow-lg hover:-translate-y-0.5 flex items-center gap-2 group">
                    <i class="fas fa-user-graduate text-xs opacity-50 group-hover:opacity-100 group-hover:text-[#D97706]"></i>
                    Mes √©tudiants
                  </a>
                {% endif %}
              </div>
            </div>

            <!-- Right Side: Profile & Logout -->
            <div class="flex items-center gap-6">
              <div class="hidden md:flex flex-col items-end">
                <span class="text-sm font-black text-white leading-none mb-1">{{ app.user.firstName|default('Utilisateur') }}</span>
                <span class="text-[10px] font-bold text-[#D97706] uppercase tracking-widest opacity-80">
                  {% if 'ROLE_ADMIN' in app.user.roles %}
                    Administrateur
                  {% elseif 'ROLE_TEACHER' in app.user.roles %}
                    Facult√©
                  {% else %}
                    √âtudiant
                  {% endif %}
                </span>
              </div>

              <div class="h-8 w-[1px] bg-white/10 hidden md:block"></div>

              <a href="{{ path('app_logout') }}" class="group flex items-center gap-2 px-5 py-2.5 rounded-xl text-xs font-black text-white bg-rose-600/10 border border-rose-500/20 hover:bg-rose-600 hover:border-rose-600 transition-all duration-300 uppercase tracking-widest">
                <span>Quitter</span>
                <i class="fas fa-power-off text-[10px] group-hover:rotate-90 transition-transform duration-500"></i>
              </a>
            </div>
          </div>
        </div>
      </nav>
    {% endif %}

    <main>
      {% for message in app.flashes('success') %}
        <div class="mb-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative" role="alert">
          <span class="block sm:inline">{{ message }}</span>
        </div>
      {% endfor %}
      {% for message in app.flashes('error') %}
        <div class="mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
          <span class="block sm:inline">{{ message }}</span>
        </div>
      {% endfor %}

      {% block body %}
      {% endblock %}
    </main>
  </body>
</html>
