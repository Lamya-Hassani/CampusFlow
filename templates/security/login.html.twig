{% extends 'base.html.twig' %}

{% block title %}Portail d'Acc√®s - CampusFlow{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        /* --- Login Specific Animations --- */
        @keyframes starry {
            0% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.2); }
            100% { opacity: 0.3; transform: scale(1); }
        }
        .animate-star { animation: starry 4s infinite ease-in-out; }

        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .input-group input:focus ~ label,
        .input-group input:not(:placeholder-shown) ~ label {
            transform: translateY(-24px) scale(0.85);
            color: #D97706; /* Amber Gold */
        }
    </style>
{% endblock %}

{% block body %}
<!-- 
    PALETTE:
    - Primary: Midnight Blue (#0F172A)
    - Accent: Amber Gold (#D97706)
    - Base: Cream Paper (#FFFBEB)
-->
<div class="min-h-screen grid lg:grid-cols-2 font-sans overflow-hidden">

    {# ============================================
       LEFT PANEL: THE VISION (Midnight Blue)
       ============================================ #}
    <div class="relative bg-[#0F172A] hidden lg:flex flex-col justify-between p-12 overflow-hidden text-white">
        <!-- Abstract Background -->
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
        <div class="absolute inset-0 bg-gradient-to-br from-[#0F172A] via-[#1E293B] to-[#0F172A]"></div>
        
        <!-- Constellation (CSS Simplified) -->
        <div class="absolute top-20 right-20 w-1 h-1 bg-[#F59E0B] rounded-full animate-star"></div>
        <div class="absolute bottom-40 left-20 w-2 h-2 bg-[#E11D48] rounded-full animate-star animation-delay-2000 opacity-60"></div>
        <svg class="absolute inset-0 w-full h-full opacity-20 pointer-events-none" xmlns="http://www.w3.org/2000/svg">
             <line x1="20%" y1="20%" x2="50%" y2="50%" stroke="#F59E0B" stroke-width="0.5" />
             <line x1="80%" y1="80%" x2="50%" y2="50%" stroke="#3A86FF" stroke-width="0.5" />
             <circle cx="50%" cy="50%" r="300" fill="url(#loginGradient)" fill-opacity="0.1" />
             <defs>
                 <radialGradient id="loginGradient">
                     <stop offset="0%" stop-color="#3A86FF" />
                     <stop offset="100%" stop-color="transparent" />
                 </radialGradient>
             </defs>
        </svg>

        <!-- Content -->
        <div class="relative z-10">
            <a href="{{ path('app_home') }}" class="flex items-center gap-3 w-fit group">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#D97706] to-[#92400E] flex items-center justify-center text-white shadow-xl border border-white/10 group-hover:scale-110 transition-transform">
                    <span class="text-xl">üèõÔ∏è</span>
                </div>
                <span class="font-heading font-bold text-2xl tracking-tight text-white">
                    Campus<span class="text-[#F59E0B]">Flow</span>
                </span>
            </a>
        </div>

        <div class="relative z-10 max-w-md">
            <div class="mb-6 w-16 h-1 bg-[#F59E0B]"></div>
            <h1 class="text-5xl font-heading font-bold leading-tight mb-6">
                Le Portail de <br/> <span class="text-[#F59E0B]">l'Excellence.</span>
            </h1>
            <p class="text-slate-400 text-lg leading-relaxed">
                Bienvenue dans votre espace num√©rique. Suivez vos performances, acc√©dez √† vos ressources et connectez-vous au futur de l'√©ducation.
            </p>
        </div>

        <div class="relative z-10 text-xs text-slate-500 uppercase tracking-widest font-bold">
            &copy; {{ "now"|date("Y") }} CampusFlow Secure System.
        </div>
    </div>

    {# ============================================
       RIGHT PANEL: THE GATE (Login Form)
       ============================================ #}
    <div class="bg-[#FFFBEB] flex items-center justify-center p-6 relative overflow-hidden">
        <!-- Interactive Background Canvas -->
        <canvas id="loginCanvas" class="absolute inset-0 w-full h-full opacity-30 pointer-events-none"></canvas>

        <!-- Mobile Back Link -->
        <a href="{{ path('app_home') }}" class="absolute top-6 left-6 lg:hidden text-slate-400 hover:text-[#0F172A] transition-colors z-20">
            <i class="fas fa-arrow-left mr-2"></i> Retour
        </a>

        <div class="w-full max-w-md relative z-10">
            <!-- Mobile Header -->
            <div class="lg:hidden text-center mb-10">
                <div class="inline-flex items-center gap-2 mb-4">
                    <span class="text-3xl">üèõÔ∏è</span>
                    <span class="font-heading font-bold text-3xl text-[#0F172A]">
                        Campus<span class="text-[#F59E0B]">Flow</span>
                    </span>
                </div>
                <p class="text-slate-500">Connectez-vous √† votre espace.</p>
            </div>

            <!-- Card Logic -->
            <div class="bg-white/80 backdrop-blur-md p-8 md:p-12 rounded-2xl shadow-[0_20px_40px_-15px_rgba(0,0,0,0.05)] border border-white/60 relative">
                
                <h2 class="text-2xl font-bold text-[#0F172A] mb-8 text-center lg:text-left">Connexion</h2>

                {% if error %}
                    <div class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-r text-sm flex items-start gap-3" role="alert">
                        <i class="fas fa-exclamation-circle mt-0.5"></i>
                        <div>{{ error.messageKey|trans(error.messageData, 'security') }}</div>
                    </div>
                {% endif %}

                {% if app.user %}
                    <div class="bg-blue-50 border-l-4 border-[#3A86FF] text-[#0F172A] p-4 mb-6 rounded-r text-sm">
                        Vous √™tes d√©j√† connect√© en tant que <strong>{{ app.user.userIdentifier }}</strong>.
                        <a href="{{ path('app_logout') }}" class="block mt-2 text-[#3A86FF] font-bold hover:underline">Se d√©connecter</a>
                    </div>
                {% endif %}

                <form method="post">
                    <!-- Email -->
                    <div class="input-group relative mb-6">
                        <input type="email" value="{{ last_username }}" name="email" id="inputEmail" autocomplete="email" required autofocus
                               class="w-full h-14 px-4 pt-2 bg-white border border-slate-200 rounded-lg text-[#0F172A] focus:outline-none focus:border-[#D97706] focus:ring-1 focus:ring-[#D97706] transition-all placeholder-transparent shadow-sm peer"
                               placeholder="Email">
                        <label for="inputEmail" class="absolute left-3 top-4 text-slate-400 text-sm transition-all pointer-events-none origin-left peer-focus:-translate-y-7 peer-focus:scale-90 peer-focus:text-[#D97706] peer-not-placeholder-shown:-translate-y-7 peer-not-placeholder-shown:scale-90 peer-not-placeholder-shown:text-[#D97706] bg-white px-1">
                            Email acad√©mique
                        </label>
                        <i class="fas fa-envelope absolute right-4 top-5 text-slate-300"></i>
                    </div>

                    <!-- Password -->
                    <div class="input-group relative mb-8">
                        <input type="password" name="password" id="inputPassword" autocomplete="current-password" required
                               class="w-full h-14 px-4 pt-2 bg-white border border-slate-200 rounded-lg text-[#0F172A] focus:outline-none focus:border-[#D97706] focus:ring-1 focus:ring-[#D97706] transition-all placeholder-transparent shadow-sm peer"
                               placeholder="Mot de passe">
                        <label for="inputPassword" class="absolute left-3 top-4 text-slate-400 text-sm transition-all pointer-events-none origin-left peer-focus:-translate-y-7 peer-focus:scale-90 peer-focus:text-[#D97706] peer-not-placeholder-shown:-translate-y-7 peer-not-placeholder-shown:scale-90 peer-not-placeholder-shown:text-[#D97706] bg-white px-1">
                            Mot de passe
                        </label>
                        <button type="button" onclick="togglePassword()" class="absolute right-4 top-5 text-slate-300 hover:text-[#0F172A] transition-colors focus:outline-none">
                            <i class="fas fa-eye" id="toggleIcon"></i>
                        </button>
                    </div>

                    <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">

                    <div class="flex items-center justify-between mb-8 text-sm">
                        <label class="flex items-center gap-2 cursor-pointer text-slate-500 hover:text-[#0F172A] transition-colors">
                            <input type="checkbox" name="_remember_me" class="w-4 h-4 rounded border-slate-300 text-[#D97706] focus:ring-[#D97706]">
                            <span>Se souvenir de moi</span>
                        </label>
                        <a href="#" class="font-bold text-[#D97706] hover:text-[#B45309] transition-colors">Mot de passe oubli√© ?</a>
                    </div>

                    <button type="submit" class="w-full py-4 bg-[#0F172A] text-white font-bold rounded-lg shadow-lg hover:bg-[#1E293B] hover:shadow-xl transition-all transform hover:-translate-y-0.5 flex items-center justify-center gap-3 group">
                        Acc√©der √† l'Espace
                        <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform text-[#F59E0B]"></i>
                    </button>
                </form>

                <div class="mt-8 text-center text-sm text-slate-400">
                    Pas encore de compte ? <a href="#" class="text-[#0F172A] font-bold hover:underline">Contacter l'administration</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function togglePassword() {
        const passwordInput = document.getElementById('inputPassword');
        const toggleIcon = document.getElementById('toggleIcon');
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleIcon.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
            passwordInput.type = 'password';
            toggleIcon.classList.replace('fa-eye', 'fa-eye');
        }
    }

    // --- Background Particles Animation (Playful School Theme) ---
    document.addEventListener('DOMContentLoaded', () => {
        const canvas = document.getElementById('loginCanvas');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];
        
        // School/Playful Icons (Emojis)
        const icons = ['üìê', 'üî¨', 'üé®', 'üéµ', '‚öΩ', 'üìö', '‚úèÔ∏è', 'üß¨', 'üíª', 'üéí', 'üß†', 'üåç'];
        
        function resize() {
            width = canvas.width = canvas.offsetWidth;
            height = canvas.height = canvas.offsetHeight;
        }
        
        class Floater {
            constructor() {
                this.text = icons[Math.floor(Math.random() * icons.length)];
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                // Random playful velocity
                this.vx = (Math.random() - 0.5) * 1.5;
                this.vy = (Math.random() - 0.5) * 1.5;
                this.size = Math.random() * 20 + 20; // 20px to 40px
                this.angle = Math.random() * Math.PI * 2;
                this.spinSpeed = (Math.random() - 0.5) * 0.05;
                this.opacity = Math.random() * 0.3 + 0.1; // Subtle transparency
            }

            update(mouseX, mouseY) {
                this.x += this.vx;
                this.y += this.vy;
                this.angle += this.spinSpeed;

                // Wall Bounce
                if (this.x < -50 || this.x > width + 50) this.vx *= -1;
                if (this.y < -50 || this.y > height + 50) this.vy *= -1;

                // Mouse Repel (Playful "Run Away")
                if(mouseX && mouseY) {
                    const dx = this.x - mouseX;
                    const dy = this.y - mouseY;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if(dist < 150) {
                        const force = (150 - dist) / 150;
                        this.vx += (dx / dist) * force * 0.5;
                        this.vy += (dy / dist) * force * 0.5;
                    }
                }
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);
                ctx.font = `${this.size}px "Segoe UI Emoji", "Noto Color Emoji", sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.globalAlpha = this.opacity;
                ctx.fillStyle = '#D97706'; // Gets overridden by emoji color usually, but good fallback
                ctx.fillText(this.text, 0, 0);
                
                // Add a faint glow/shadow for depth
                // ctx.shadowBlur = 10;
                // ctx.shadowColor = "rgba(217, 119, 6, 0.2)";
                
                ctx.restore();
            }
        }

        function init() {
            particles = [];
            for (let i = 0; i < 25; i++) particles.push(new Floater());
        }

        let mouseX = null;
        let mouseY = null;
        window.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
        });
        window.addEventListener('mouseleave', () => { mouseX = null; mouseY = null; });

        function animate() {
            ctx.clearRect(0, 0, width, height);
            particles.forEach(p => { 
                p.update(mouseX, mouseY); 
                p.draw(); 
            });
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', () => { resize(); init(); });
        resize();
        init();
        animate();
    });
</script>
{% endblock %}
